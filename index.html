<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drive Gallery Manager Pro</title>
    <style>
        /* --- TEMEL AYARLAR --- */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: #f4f4f4; margin: 0; }
        .container { position: relative; max-width: 700px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .label { font-weight: bold; margin-top: 15px; display: block; margin-bottom: 5px; color: #333; }

        /* --- DİL MENÜSÜ --- */
        .lang-wrapper { position: absolute; top: 20px; right: 20px; z-index: 50; }
        .lang-btn {
            background: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 5px 10px; cursor: pointer;
            font-size: 13px; font-weight: 600; color: #333; display: flex; align-items: center; justify-content: center;
            gap: 6px; height: 32px; transition: background 0.2s, border-color 0.2s;
        }
        .lang-btn:hover { background: #f8f9fa; border-color: #bbb; }
        .lang-icon { width: 16px; height: 16px; fill: #333; display: block; }
        .lang-list {
            display: none; position: absolute; top: 100%; right: 0; margin-top: 5px; background: white;
            border: 1px solid #ddd; border-radius: 4px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            list-style: none; padding: 0; width: 150px; max-height: 300px; overflow-y: auto;
        }
        .lang-list li { padding: 8px 12px; cursor: pointer; font-size: 13px; border-bottom: 1px solid #f0f0f0; color: #333; }
        .lang-list li:hover { background-color: #f0f0f0; }

        /* --- INPUT ALANI --- */
        .input-group { display: flex; align-items: center; margin: 10px 0; }
        input[type="text"] { 
            flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px 0 0 4px; border-right: none; height: 45px; box-sizing: border-box; transition: border-color 0.3s; font-size: 14px;
        }
        button:active { transform: scale(0.96); }
        .paste-btn {
            background-color: #6c757d; color: white; border: 1px solid #6c757d; border-radius: 0 4px 4px 0;
            cursor: pointer; width: 50px; height: 45px; display: flex; align-items: center; justify-content: center;
            transition: background-color 0.2s, transform 0.2s; padding: 0;
        }
        .paste-btn:hover { background-color: #5c636a; }
        .paste-btn svg { width: 22px; height: 22px; fill: white; }

        .convert-btn { 
            background-color: #0d6efd; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; width: 100%; 
            font-size: 15px; margin-bottom: 5px; font-weight: bold; transition: background-color 0.3s, transform 0.2s;
        }
        .convert-btn:hover { background-color: #0b5ed7; }
        .convert-btn.passive { background-color: #adb5bd !important; cursor: not-allowed; transform: none !important; pointer-events: none; }
        .convert-btn.success-lock:active { transform: none !important; } .convert-btn.success-lock { cursor: default; }

        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
        .error-shake { animation: shake 0.3s ease-in-out; background-color: #dc3545 !important; }

        /* --- GALERİ GRID SİSTEMİ --- */
        #galleryArea { margin-top: 20px; display: none; }
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .gallery-item {
            position: relative;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
            aspect-ratio: 1; 
            background: #eee;
            cursor: zoom-in;
            transition: transform 0.2s, border-color 0.2s;
        }
        .gallery-item:hover { transform: scale(1.02); }
        .gallery-item img {
            width: 100%; height: 100%; object-fit: cover; display: block;
        }
        
        .gallery-item.active-item {
            border: 3px solid #198754;
            box-shadow: 0 0 10px rgba(25, 135, 84, 0.3);
        }

        .overlay-copy-btn {
            position: absolute;
            top: 5px; right: 5px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            border-radius: 50%;
            width: 28px; height: 28px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s, background-color 0.2s;
            z-index: 5;
        }
        .overlay-copy-btn:hover { background: #fd7e14; border-color: #fd7e14; color: white; }
        .gallery-item:hover .overlay-copy-btn { opacity: 1; }
        .overlay-copy-btn svg { width: 14px; height: 14px; fill: currentColor; }

        /* --- GALERİ KONTROL PANELİ (BATCH) --- */
        .batch-controls {
            margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center; display: none; 
        }
        .btn-outline-danger {
            background: white; border: 1px solid #dc3545; color: #dc3545; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 13px;
        }
        .btn-outline-danger:hover { background: #dc3545; color: white; }
        
        .btn-primary-soft {
            background: #e7f1ff; border: 1px solid #0d6efd; color: #0d6efd; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 600;
        }
        .btn-primary-soft:hover { background: #0d6efd; color: white; }

        /* --- LIGHTBOX (TAM EKRAN) --- */
        .modal {
            display: none; position: fixed; left: 0; top: 0; width: 100%; height: 100%; 
            overflow: auto; backdrop-filter: blur(4px);
        }
        /* Detaylar Modalı için Z-Index */
        #detailsModal { z-index: 1000; background-color: rgba(0,0,0,0.6); }
        /* Lightbox Modalı için Z-Index (Daha yüksek olmalı ki üstte çıksın) */
        #lightboxModal { z-index: 2000; background-color: rgba(0,0,0,0.95); }
        
        .lightbox-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;
        }
        .lightbox-img {
            max-width: 90%; max-height: 85vh; border-radius: 4px; box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        
        /* NAVIGASYON BUTONLARI (DÜZELTİLDİ) */
        .lb-btn {
            position: absolute; 
            background: rgba(255,255,255,0.15); 
            color: white; border: none;
            cursor: pointer; 
            padding: 20px; 
            font-size: 30px; 
            border-radius: 5px; 
            top: 50%; 
            /* Y ekseninde %50 yukarı alarak tam ortala */
            transform: translateY(-50%); 
            transition: background 0.2s, transform 0.1s;
            /* Seçimi engelle ki hızlı tıklayınca bozulmasın */
            user-select: none; 
            -webkit-user-select: none;
        }
        .lb-btn:hover { background: rgba(255,255,255,0.4); }
        /* Active durumunda Y eksenini sabit tut, sadece scale et (Zıplamayı önler) */
        .lb-btn:active { transform: translateY(-50%) scale(0.9); }
        
        .lb-prev { left: 20px; }
        .lb-next { right: 20px; }
        
        /* Kopyala Butonu */
        .lb-copy {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: #fd7e14; color: white; padding: 10px 25px; border-radius: 20px; border: none;
            cursor: pointer; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: background 0.2s, transform 0.1s;
        }
        .lb-copy:hover { background: #e36906; }
        .lb-copy:active { transform: translateX(-50%) scale(0.95); }

        /* Sil Butonu (Lightbox) */
        .lb-trash {
            position: absolute; bottom: 30px; right: 30px;
            background: rgba(220, 53, 69, 0.8); color: white;
            width: 45px; height: 45px; border-radius: 50%; border: none;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: background 0.2s, transform 0.1s;
        }
        .lb-trash:hover { background: #dc3545; }
        .lb-trash:active { transform: scale(0.9); }
        .lb-trash svg { width: 20px; height: 20px; fill: white; }

        .close-modal {
            position: absolute; top: 20px; right: 30px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; z-index: 2002;
        }

        /* --- DETAY TABLOSU MODALI --- */
        .details-modal-content {
            background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888;
            width: 80%; max-width: 800px; border-radius: 8px; position: relative; max-height: 90vh; overflow-y: auto;
        }
        .details-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .close-details {
            position: absolute; top: 15px; right: 20px; color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer;
        }
        .close-details:hover { color: black; }
        
        table.link-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        table.link-table th, table.link-table td { border: 1px solid #ddd; padding: 8px; text-align: left; vertical-align: middle; }
        table.link-table th { background-color: #f2f2f2; font-weight: 600; }
        .tbl-thumb { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; cursor: zoom-in; display: block; }
        
        .tbl-btn { background: #6c757d; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-right: 5px; }
        .tbl-btn:hover { background: #5c636a; }
        
        .btn-danger-sm { background: #dc3545; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .btn-danger-sm:hover { background: #bb2d3b; }
        
        .btn-copy-all {
            background: #198754; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 5px;
        }
        .btn-copy-all:hover { background: #157347; }

    </style>
</head>
<body>

<div id="lightboxModal" class="modal">
    <span class="close-modal" onclick="closeLightbox()">&times;</span>
    <div class="lightbox-container">
        <button class="lb-btn lb-prev" onclick="changeSlide(-1)">&#10094;</button>
        <img class="lightbox-img" id="lbImage">
        <button class="lb-btn lb-next" onclick="changeSlide(1)">&#10095;</button>
        
        <button class="lb-copy" id="lbCopyBtn" onclick="copyFromLightbox()" title="Kısayol: C">Linki Kopyala</button>
        
        <button class="lb-trash" onclick="deleteFromLightbox()" title="Sil (Kısayol: Delete)">
            <svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
        </button>
    </div>
</div>

<div id="detailsModal" class="modal">
    <div class="details-modal-content">
        <span class="close-details" onclick="closeDetails()">&times;</span>
        <div class="details-header">
            <h3 data-lang="modalTitle" style="margin:0;">Oluşturulan Linkler</h3>
            <button class="btn-copy-all" onclick="copyAllLinks()">
                <svg style="width:16px;height:16px;fill:white" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                <span data-lang="btnCopyAll">Tümünü Kopyala</span>
            </button>
        </div>
        <table class="link-table">
            <thead>
                <tr>
                    <th data-lang="thImage" style="width: 60px;">Resim</th>
                    <th data-lang="thDirect">Direkt Link</th>
                    <th data-lang="thAction" style="width: 140px;">İşlem</th>
                </tr>
            </thead>
            <tbody id="detailsTableBody">
                </tbody>
        </table>
    </div>
</div>

<div class="container">
    <div class="lang-wrapper">
        <button class="lang-btn" onclick="toggleLangMenu(event)">
            <svg class="lang-icon" viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM2.04 4.326c.325 1.329 2.532 2.54 6.354 2.919V5.256c-4.42-1.379-6.354-2.919-6.354-2.919zm.344 7.625c.325-1.329 2.532-2.54 6.354-2.919v5.733c-3.822-.38-6.029-1.59-6.354-2.919zm11.576-7.625c-.325 1.329-2.532 2.54-6.354 2.919V5.256c4.42-1.379 6.354-2.919 6.354-2.919zm-.344 7.625c-.325-1.329-2.532-2.54-6.354-2.919v5.733c3.822-.38 6.029-1.59 6.354-2.919z"/><path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855.173-.324.33-.682.468-1.068H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"/></svg>
            <span id="currentLangLabel">TR</span>
        </button>
        <ul class="lang-list" id="langList">
            <li onclick="selectLang('tr')">Türkçe</li>
            <li onclick="selectLang('en')">English</li>
            <li onclick="selectLang('de')">Deutsch</li>
            <li onclick="selectLang('es')">Español</li>
            <li onclick="selectLang('fr')">Français</li>
        </ul>
    </div>

    <h3 style="margin-top:0; padding-right: 80px;" data-lang="title">Google Drive Resim Linki Dönüştürücü</h3>
    
    <label class="label" data-lang="labelInput">Normal Drive Linki:</label>
    <div class="input-group">
        <input type="text" id="driveLink" placeholder="https://drive.google.com/file/d/...." onclick="this.select()" oninput="dinamikKontrol()">
        <button class="paste-btn" id="btnPaste" onclick="yapistir()" title="Panodan Yapıştır">
            <svg viewBox="0 0 24 24"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 16H5V5h2v1c0 .55.45 1 1 1h8c.55 0 1-.45 1-1V5h2v14z"/></svg>
        </button>
    </div>
    
    <button id="btnConvert" class="convert-btn" onclick="linkDonustur()" data-lang="btnConvert">Dönüştür</button>

    <div id="galleryArea">
        <label class="label" data-lang="labelGallery">Oluşturulan Resimler:</label>
        <div class="gallery-grid" id="galleryGrid"></div>
        <div class="batch-controls" id="batchControls">
            <button class="btn-primary-soft" onclick="showDetails()" data-lang="btnDetails">Detaylı Liste</button>
            <button class="btn-outline-danger" onclick="clearGallery()" data-lang="btnClear">Tümünü Temizle</button>
        </div>
    </div>
</div>

<script>
    let history = []; 
    let currentLang = 'tr';
    let dinamikModAktif = false; 
    let activeLightboxIndex = 0; 
    const driveRegex = /drive\.google\.com\/.*?\/d\/([a-zA-Z0-9_-]{25,})/;

    const translations = {
        tr: { title: "Google Drive Resim Linki Dönüştürücü", labelInput: "Normal Drive Linki:", placeholder: "https://drive.google.com/file/d/....", btnConvert: "Dönüştür", labelGallery: "Oluşturulan Resimler:", btnDetails: "Detaylı Liste", btnClear: "Tümünü Temizle", errEmpty: "Link Girilmedi!", errInvalid: "Geçersiz Link!", msgCopied: "Kopyalandı!", btnCopy: "Linki Kopyala", modalTitle: "Oluşturulan Linkler", thImage: "Resim", thDirect: "Direkt Link", thAction: "İşlem", btnDelete: "Sil", btnCopyAll: "Tümünü Kopyala" },
        en: { title: "Google Drive Direct Link Generator", labelInput: "Original Drive Link:", placeholder: "Paste your link here...", btnConvert: "Convert", labelGallery: "Generated Images:", btnDetails: "Detailed List", btnClear: "Clear All", errEmpty: "No Link Entered!", errInvalid: "Invalid Link!", msgCopied: "Copied!", btnCopy: "Copy Link", modalTitle: "Generated Links", thImage: "Image", thDirect: "Direct Link", thAction: "Action", btnDelete: "Delete", btnCopyAll: "Copy All" },
        de: { title: "Google Drive Direktlink-Generator", labelInput: "Original-Link:", placeholder: "Link hier einfügen...", btnConvert: "Umwandeln", labelGallery: "Generierte Bilder:", btnDetails: "Detaillierte Liste", btnClear: "Alles löschen", errEmpty: "Kein Link eingegeben!", errInvalid: "Ungültiger Link!", msgCopied: "Kopiert!", btnCopy: "Link kopieren", modalTitle: "Generierte Links", thImage: "Bild", thDirect: "Direktlink", thAction: "Aktion", btnDelete: "Löschen", btnCopyAll: "Alles Kopieren" },
        fr: { title: "Générateur de liens directs Drive", labelInput: "Lien Original:", placeholder: "Collez votre lien ici...", btnConvert: "Convertir", labelGallery: "Images générées :", btnDetails: "Liste détaillée", btnClear: "Tout effacer", errEmpty: "Aucun lien saisi !", errInvalid: "Lien invalide !", msgCopied: "Copié !", btnCopy: "Copier le lien", modalTitle: "Liens générés", thImage: "Image", thDirect: "Lien direct", thAction: "Action", btnDelete: "Supprimer", btnCopyAll: "Tout Copier" },
        es: { title: "Generador de Enlaces Directos Drive", labelInput: "Enlace Original:", placeholder: "Pega tu enlace aquí...", btnConvert: "Convertir", labelGallery: "Imágenes Generadas:", btnDetails: "Lista Detallada", btnClear: "Borrar Todo", errEmpty: "¡Enlace no introducido!", errInvalid: "¡Enlace Inválido!", msgCopied: "¡Copiado!", btnCopy: "Copiar Enlace", modalTitle: "Enlaces Generados", thImage: "Imagen", thDirect: "Enlace Directo", thAction: "Acción", btnDelete: "Eliminar", btnCopyAll: "Copiar Todo" }
    };

    function toggleLangMenu(e) { e.stopPropagation(); var l = document.getElementById("langList"); l.style.display = (l.style.display === "block") ? "none" : "block"; }
    function selectLang(c) { currentLang = c; document.getElementById("currentLangLabel").innerText = c.toUpperCase(); document.getElementById("langList").style.display = "none"; applyTranslations(); }
    document.addEventListener('click', function(e) { var l = document.getElementById("langList"); var b = document.querySelector(".lang-btn"); if (l.style.display === "block" && !l.contains(e.target) && !b.contains(e.target)) { l.style.display = "none"; } });

    function applyTranslations() {
        const t = translations[currentLang];
        document.querySelectorAll('[data-lang]').forEach(el => { if (t[el.getAttribute('data-lang')]) el.innerText = t[el.getAttribute('data-lang')]; });
        document.getElementById('driveLink').placeholder = t.placeholder;
        let lbCopy = document.getElementById('lbCopyBtn');
        if(!lbCopy.innerText.includes("!")) lbCopy.innerText = t.btnCopy;
        var btnConvert = document.getElementById('btnConvert');
        if (!btnConvert.classList.contains('error-shake')) btnConvert.innerText = t.btnConvert;
        if(document.getElementById("detailsModal").style.display === "block") showDetails(); // Tabloyu güncelle
    }

    function linkDonustur() {
        var btn = document.getElementById("btnConvert");
        if(btn.classList.contains('passive')) return;
        var inputElement = document.getElementById("driveLink");
        var val = inputElement.value.trim();
        const t = translations[currentLang];
        if(val === "") { hataAnimasyonu(t.errEmpty); return; }
        if (val.match(/\/d\/(.+?)\//) && !val.startsWith("http")) { val = "https://" + val; inputElement.value = val; }
        var idMatch = val.match(driveRegex);
        if (!idMatch) { hataAnimasyonu(t.errInvalid); return; }
        var fileID = idMatch[1];
        var newLink = "https://drive.google.com/thumbnail?id=" + fileID + "&sz=w10000";
        history = history.filter(item => item.id !== fileID);
        history.push({ id: fileID, directLink: newLink, originalLink: val });
        renderGallery();
        dinamikModAktif = false; btn.classList.add("success-lock");
    }

    function renderGallery() {
        const grid = document.getElementById("galleryGrid");
        const area = document.getElementById("galleryArea");
        const batchCtrl = document.getElementById("batchControls");
        grid.innerHTML = ""; 
        if(history.length > 0) {
            area.style.display = "block";
            batchCtrl.style.display = (history.length > 1) ? "flex" : "none";
        } else {
            area.style.display = "none"; return;
        }
        history.forEach((item, index) => {
            let div = document.createElement("div"); div.className = "gallery-item";
            if(index === history.length - 1) div.classList.add("active-item");
            let img = document.createElement("img"); img.src = item.directLink; img.onclick = () => openLightbox(index);
            let btn = document.createElement("div"); btn.className = "overlay-copy-btn";
            btn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>';
            btn.onclick = (e) => { e.stopPropagation(); copyDirect(item.directLink, btn); };
            div.appendChild(img); div.appendChild(btn); grid.appendChild(div);
        });
        // Eğer detay tablosu açıksa onu da güncelle
        if(document.getElementById("detailsModal").style.display === "block") {
            showDetails();
        }
    }

    function clearGallery() {
        history = []; renderGallery();
        document.getElementById("driveLink").value = "";
        document.getElementById("btnConvert").classList.remove("success-lock");
    }

    function openLightbox(index) {
        activeLightboxIndex = index;
        updateLightboxContent();
        document.getElementById("lightboxModal").style.display = "block";
        document.addEventListener('keydown', lightboxKeyHandler);
    }

    function closeLightbox() {
        document.getElementById("lightboxModal").style.display = "none";
        document.removeEventListener('keydown', lightboxKeyHandler);
    }

    function updateLightboxContent() {
        if (history.length === 0) { closeLightbox(); return; }
        if (activeLightboxIndex >= history.length) activeLightboxIndex = 0;
        let item = history[activeLightboxIndex];
        document.getElementById("lbImage").src = item.directLink;
        const t = translations[currentLang];
        let btn = document.getElementById("lbCopyBtn");
        btn.innerText = t.btnCopy; btn.style.backgroundColor = "#fd7e14";
    }

    function changeSlide(direction) {
        if(history.length === 0) return;
        activeLightboxIndex += direction;
        if (activeLightboxIndex >= history.length) activeLightboxIndex = 0;
        if (activeLightboxIndex < 0) activeLightboxIndex = history.length - 1;
        updateLightboxContent();
    }

    function lightboxKeyHandler(e) {
        if (e.key === "ArrowRight") changeSlide(1);
        if (e.key === "ArrowLeft") changeSlide(-1);
        if (e.key === "Escape") closeLightbox();
        if (e.key.toLowerCase() === "c") copyFromLightbox();
        if (e.key === "Delete" || e.key === "Backspace") deleteFromLightbox();
    }

    function copyFromLightbox() {
        let link = history[activeLightboxIndex].directLink;
        let btn = document.getElementById("lbCopyBtn");
        const t = translations[currentLang];
        navigator.clipboard.writeText(link).then(() => {
            btn.innerText = t.msgCopied; btn.style.backgroundColor = "#198754";
            setTimeout(() => { btn.innerText = t.btnCopy; btn.style.backgroundColor = "#fd7e14"; }, 1500);
        });
    }

    // --- YENİ SİLME FONKSİYONU (LIGHTBOX) ---
    function deleteFromLightbox() {
        if(history.length === 0) return;
        // Diziden sil
        history.splice(activeLightboxIndex, 1);
        
        // Eğer sildikten sonra index liste dışına çıkarsa (son elemanı sildiysek)
        if(activeLightboxIndex >= history.length) {
            activeLightboxIndex = history.length - 1;
        }

        // Arka planı güncelle
        renderGallery();
        
        // Lightbox'ı güncelle (veya kapat)
        if(history.length === 0) {
            closeLightbox();
        } else {
            updateLightboxContent();
        }
    }

    function showDetails() {
        const tbody = document.getElementById("detailsTableBody");
        const t = translations[currentLang];
        tbody.innerHTML = "";
        history.forEach((item, index) => {
            let row = document.createElement("tr");
            
            let cellImg = document.createElement("td");
            let img = document.createElement("img");
            img.src = item.directLink; img.className = "tbl-thumb";
            img.onclick = () => { /* Lightbox'ı aç ama detayları kapatma */ openLightbox(index); };
            cellImg.appendChild(img);

            let cellLink = document.createElement("td");
            cellLink.innerText = item.directLink.substring(0, 40) + "...";
            cellLink.style.wordBreak = "break-all";

            let cellAct = document.createElement("td");
            let btnCopy = document.createElement("button");
            btnCopy.className = "tbl-btn"; btnCopy.innerText = t.btnCopy;
            btnCopy.onclick = () => {
                navigator.clipboard.writeText(item.directLink).then(() => {
                    btnCopy.innerText = t.msgCopied; btnCopy.style.backgroundColor = "#198754";
                    setTimeout(() => { btnCopy.innerText = t.btnCopy; btnCopy.style.backgroundColor = "#6c757d"; }, 1000);
                });
            };
            
            let btnDel = document.createElement("button");
            btnDel.className = "btn-danger-sm"; btnDel.innerText = t.btnDelete;
            btnDel.onclick = () => {
                history.splice(index, 1);
                renderGallery(); // Tabloyu da tetikler
                if(history.length === 0) closeDetails();
            };

            cellAct.appendChild(btnCopy);
            cellAct.appendChild(btnDel);
            row.appendChild(cellImg); row.appendChild(cellLink); row.appendChild(cellAct);
            tbody.appendChild(row);
        });
        document.getElementById("detailsModal").style.display = "block";
    }

    function copyAllLinks() {
        const t = translations[currentLang];
        let allLinks = history.map(item => item.directLink).join("\n");
        navigator.clipboard.writeText(allLinks).then(() => {
            let btn = document.querySelector(".btn-copy-all span");
            let oldText = btn.innerText;
            btn.innerText = t.msgCopied;
            setTimeout(() => { btn.innerText = t.btnCopyAll || "Tümünü Kopyala"; }, 1500);
        });
    }

    function closeDetails() { document.getElementById("detailsModal").style.display = "none"; }
    function copyDirect(link, btnElement) {
        navigator.clipboard.writeText(link).then(() => {
            let originalBg = btnElement.style.background;
            btnElement.style.background = "#198754"; btnElement.style.color = "white";
            setTimeout(() => { btnElement.style.background = ""; btnElement.style.color = ""; }, 500);
        });
    }

    function dinamikKontrol() {
        document.getElementById("btnConvert").classList.remove("success-lock");
        if (!dinamikModAktif) return;
        var val = document.getElementById("driveLink").value.trim();
        var btn = document.getElementById("btnConvert");
        const t = translations[currentLang];
        if (val === "") { btn.classList.add("passive"); btn.innerText = t.errEmpty; return; }
        if (!val.match(driveRegex)) { btn.classList.add("passive"); btn.innerText = t.errInvalid; } 
        else { btn.classList.remove("passive"); btn.innerText = t.btnConvert; }
    }

    function hataAnimasyonu(mesaj) {
        var btn = document.getElementById("btnConvert");
        btn.classList.remove("success-lock"); btn.classList.add("error-shake"); btn.innerText = mesaj; dinamikModAktif = true;
        setTimeout(() => { btn.classList.remove("error-shake"); btn.classList.add("passive"); }, 1000);
    }

    async function yapistir() {
        var inputAlani = document.getElementById("driveLink");
        var pasteBtn = document.getElementById("btnPaste");
        try {
            const text = await navigator.clipboard.readText();
            var processedText = text.trim();
            if (processedText.match(driveRegex) && !processedText.startsWith("http")) processedText = "https://" + processedText;
            if (inputAlani.value === processedText) return; 
            inputAlani.value = processedText; dinamikKontrol();
            pasteBtn.style.backgroundColor = "#198754"; setTimeout(() => pasteBtn.style.backgroundColor = "", 1500);
            if (processedText.match(driveRegex)) linkDonustur();
        } catch (err) { console.error("Hata:", err); inputAlani.value = ""; dinamikKontrol(); }
    }
</script>

</body>
</html>
