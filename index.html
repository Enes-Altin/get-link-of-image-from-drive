<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drive Gallery Pro V18</title>
    <style>
        /* --- TEMEL AYARLAR --- */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: #f4f4f4; margin: 0; }
        .container { position: relative; max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .label { font-weight: bold; margin-top: 15px; display: block; margin-bottom: 5px; color: #333; }

        /* --- DİL MENÜSÜ --- */
        .lang-wrapper { position: absolute; top: 20px; right: 20px; z-index: 50; }
        .lang-btn {
            background: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 5px 10px; cursor: pointer;
            font-size: 13px; font-weight: 600; color: #333; display: flex; align-items: center; justify-content: center;
            gap: 6px; height: 32px; transition: background 0.2s;
        }
        .lang-btn:hover { background: #f8f9fa; border-color: #bbb; }
        .lang-icon { width: 16px; height: 16px; fill: #333; display: block; }
        .lang-list {
            display: none; position: absolute; top: 100%; right: 0; margin-top: 5px; background: white;
            border: 1px solid #ddd; border-radius: 4px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            list-style: none; padding: 0; width: 150px; max-height: 300px; overflow-y: auto;
        }
        .lang-list li { padding: 8px 12px; cursor: pointer; font-size: 13px; border-bottom: 1px solid #f0f0f0; color: #333; }
        .lang-list li:hover { background-color: #f0f0f0; }

        /* --- INPUT --- */
        .input-group { display: flex; align-items: center; margin: 10px 0; }
        input[type="text"] { 
            flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px 0 0 4px; border-right: none; height: 45px; box-sizing: border-box; transition: border-color 0.3s; font-size: 14px;
        }
        button:active { transform: scale(0.96); }
        .paste-btn {
            background-color: #6c757d; color: white; border: 1px solid #6c757d; border-radius: 0 4px 4px 0;
            cursor: pointer; width: 50px; height: 45px; display: flex; align-items: center; justify-content: center;
            transition: background-color 0.2s, transform 0.2s; padding: 0;
        }
        .paste-btn:hover { background-color: #5c636a; }
        .paste-btn svg { width: 22px; height: 22px; fill: white; }

        .convert-btn { 
            background-color: #0d6efd; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; width: 100%; 
            font-size: 15px; margin-bottom: 5px; font-weight: bold; transition: background-color 0.3s, transform 0.2s;
        }
        .convert-btn:hover { background-color: #0b5ed7; }
        .convert-btn.passive { background-color: #adb5bd !important; cursor: not-allowed; transform: none !important; pointer-events: none; }
        .convert-btn.success-lock:active { transform: none !important; } .convert-btn.success-lock { cursor: default; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
        .error-shake { animation: shake 0.3s ease-in-out; background-color: #dc3545 !important; }

        /* --- GALERİ GRID --- */
        #galleryArea { margin-top: 20px; display: none; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 10px; }
        .gallery-item {
            position: relative; border: 1px solid #ddd; border-radius: 6px; overflow: hidden; aspect-ratio: 1; background: #eee;
            cursor: zoom-in; transition: transform 0.2s, border-color 0.2s;
        }
        .gallery-item:hover { transform: scale(1.02); }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; display: block; transition: filter 0.2s; }
        
        @keyframes flashEffect { 0% { filter: brightness(1); } 50% { filter: brightness(1.8) sepia(0.5) hue-rotate(90deg); } 100% { filter: brightness(1); } }
        .flash-anim { animation: flashEffect 0.4s ease-out; }

        /* YENİ EKLENENLER (YEŞİL) */
        .gallery-item.active-item { border: 3px solid #198754; box-shadow: 0 0 10px rgba(25, 135, 84, 0.3); }
        
        /* SEÇİLENLER (TURUNCU) */
        .gallery-item.selected-item { border: 3px solid #fd7e14 !important; transform: scale(0.95); opacity: 0.9; }
        
        .overlay-copy-btn {
            position: absolute; top: 5px; right: 5px; background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc; border-radius: 50%; width: 28px; height: 28px;
            display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0;
            transition: opacity 0.2s, background-color 0.2s; z-index: 5;
        }
        .gallery-item:hover .overlay-copy-btn { opacity: 1; }
        .overlay-copy-btn:hover { background: #fd7e14; border-color: #fd7e14; color: white; }
        .overlay-copy-btn svg { width: 14px; height: 14px; fill: currentColor; }

        /* Batch Controls */
        .batch-controls { margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee; display: flex; justify-content: space-between; display: none; }
        .btn-outline-danger { background: white; border: 1px solid #dc3545; color: #dc3545; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; }
        .btn-outline-danger:hover { background: #dc3545; color: white; }
        .btn-primary-soft { background: #e7f1ff; border: 1px solid #0d6efd; color: #0d6efd; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 600; }
        .btn-primary-soft:hover { background: #0d6efd; color: white; }
        
        /* GİZLİ SİLME BUTONU (SOLDA) */
        .btn-delete-selected {
            background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; 
            display: none; /* Başlangıçta gizli */
            margin-right: auto; /* Sola yasla */
        }
        .btn-delete-selected:hover { background: #bb2d3b; }

        /* --- MODALS --- */
        .modal {
            display: none; position: fixed; left: 0; top: 0; width: 100%; height: 100%; 
            overflow: auto; backdrop-filter: blur(4px);
        }
        #detailsModal { z-index: 1000; background-color: rgba(0,0,0,0.6); }
        #lightboxModal { z-index: 2000; background-color: rgba(0,0,0,0.95); }
        #confirmModal { z-index: 3000; background-color: rgba(0,0,0,0.5); }

        /* --- LIGHTBOX --- */
        .lightbox-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;
        }
        .lightbox-img {
            max-width: 90%; max-height: 80vh; border-radius: 4px; box-shadow: 0 0 30px rgba(0,0,0,0.5);
            /* Başlangıçta transition açık */
            transition: transform 0.2s ease;
        }
        
        /* Yan Tuşlar (Orta - Sadece Klavye ile Animasyon) */
        .lb-btn {
            position: absolute; background: rgba(255,255,255,0.15); color: white; border: none;
            cursor: pointer; padding: 20px; font-size: 30px; border-radius: 5px; top: 50%; transform: translateY(-50%); 
            transition: background 0.2s, transform 0.1s; user-select: none;
        }
        .lb-btn:hover { background: rgba(255,255,255,0.4); }
        .lb-btn.key-active { transform: translateY(-50%) scale(0.9); background: rgba(255,255,255,0.6); }
        .lb-prev { left: 20px; } .lb-next { right: 20px; }

        /* Alt Kontrol Barı (DÜZENLENDİ) */
        .lb-bottom-bar {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.7); padding: 10px 25px; border-radius: 40px;
            width: auto; min-width: 300px; gap: 40px;
        }
        
        /* Gruplar */
        .lb-left-group { display: flex; justify-content: flex-start; }
        .lb-center-group { display: flex; gap: 10px; align-items: center; }
        .lb-right-group { display: flex; gap: 2px; }

        .lb-mini-nav {
            background: rgba(255,255,255,0.2); color: white; border: none; width: 40px; height: 40px;
            cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: background 0.2s;
        }
        .lb-mini-nav:hover { background: rgba(255,255,255,0.4); }
        .lb-mini-nav:active { background: rgba(255,255,255,0.5); }
        
        /* Kenar yuvarlama (Sol/Sağ oklar) */
        .lb-right-group .lb-mini-nav:first-child { border-radius: 20px 0 0 20px; }
        .lb-right-group .lb-mini-nav:last-child { border-radius: 0 20px 20px 0; }

        /* Zoom Tuşları */
        .lb-zoom-btn {
            background: rgba(255,255,255,0.2); color: white; border: none; width: 35px; height: 35px;
            cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;
        }
        .lb-zoom-btn:hover { background: rgba(255,255,255,0.4); }
        .lb-zoom-group { display: flex; border-radius: 20px; overflow: hidden; margin-right: 10px;}

        .lb-copy {
            background: #fd7e14; color: white; padding: 0 20px; height: 40px; border-radius: 20px; border: none;
            cursor: pointer; font-weight: bold; transition: background 0.2s, transform 0.1s; white-space: nowrap; font-size: 14px;
        }
        .lb-copy:hover { background: #e36906; } .lb-copy:active { transform: scale(0.95); }

        .lb-trash {
            background: rgba(220, 53, 69, 0.8); color: white; width: 40px; height: 40px; border-radius: 50%; border: none;
            cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.2s, transform 0.1s;
        }
        .lb-trash:hover { background: #dc3545; } .lb-trash:active { transform: scale(0.9); }
        .lb-trash svg { width: 18px; height: 18px; fill: white; }

        .close-modal { position: absolute; top: 20px; right: 30px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; z-index: 2002; }

        /* --- DETAY TABLOSU --- */
        .details-modal-content {
            background-color: #fefefe; margin: 5% auto; border: 1px solid #888;
            width: 90%; max-width: 900px; border-radius: 8px; display: flex; flex-direction: column; max-height: 90vh;
        }
        .details-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .details-body { overflow-y: auto; padding: 20px; }
        .details-footer { padding: 15px 20px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px; background: #f9f9f9; border-radius: 0 0 8px 8px; }
        
        .close-details { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; line-height: 1; }
        .close-details:hover { color: black; }

        table.link-table { width: 100%; border-collapse: collapse; font-size: 13px; table-layout: fixed; }
        table.link-table th, table.link-table td { border: 1px solid #ddd; padding: 10px; text-align: left; vertical-align: middle; }
        table.link-table th { background-color: #f2f2f2; font-weight: 600; }
        .tbl-thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; cursor: zoom-in; display: block; }
        
        /* Kaydırmalı Link Alanı Düzeltildi */
        .link-text-wrapper {
            display: flex; align-items: center; gap: 8px;
            border: 1px solid #eee; padding: 5px 8px; border-radius: 4px; overflow: hidden;
            width: 100%; box-sizing: border-box;
        }
        .link-text {
            overflow-x: auto; white-space: nowrap; 
            font-family: monospace; color: #555; 
            flex: 1; /* Esnek genişlik */
            min-width: 0; /* Flexbox taşmasını önler */
            scrollbar-width: none; -ms-overflow-style: none;
        }
        .link-text::-webkit-scrollbar { display: none; }

        .btn-copy-sm { background: #6c757d; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap; flex-shrink: 0; }
        .btn-copy-sm:hover { background: #5c636a; }
        .btn-danger-sm { background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .btn-danger-sm:hover { background: #bb2d3b; }

        .btn-footer { padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; border: none; display: flex; align-items: center; gap: 8px; color: white; font-weight: 500; }
        .btn-copy-all { background: #198754; } .btn-copy-all:hover { background: #157347; }
        .btn-excel { background: #217346; } .btn-excel:hover { background: #1a5c38; }

        /* --- CUSTOM CONFIRM MODAL --- */
        .confirm-box {
            background: white; width: 400px; margin: 15% auto; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .confirm-thumb { width: 100px; height: 100px; object-fit: cover; border-radius: 6px; margin: 10px auto; display: block; border: 1px solid #ddd; }
        .confirm-btns { margin-top: 20px; display: flex; justify-content: center; gap: 10px; }
        .btn-yes { background: #dc3545; color: white; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer; }
        .btn-no { background: #6c757d; color: white; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer; }

    </style>
</head>
<body onclick="handleGlobalClick(event)">

<div id="lightboxModal" class="modal">
    <span class="close-modal" onclick="closeLightbox()">&times;</span>
    <div class="lightbox-container">
        <button class="lb-btn lb-prev" id="lbMidPrev" onclick="changeSlide(-1)">&#10094;</button>
        <img class="lightbox-img" id="lbImage">
        <button class="lb-btn lb-next" id="lbMidNext" onclick="changeSlide(1)">&#10095;</button>
        
        <div class="lb-bottom-bar">
            <div class="lb-left-group">
                <button class="lb-trash" onclick="deleteFromLightbox()" title="Sil (Delete)">
                    <svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                </button>
            </div>

            <div class="lb-center-group">
                <div class="lb-zoom-group">
                    <button class="lb-zoom-btn" onclick="zoomImage(-0.2)">-</button>
                    <button class="lb-zoom-btn" onclick="zoomImage(0.2)">+</button>
                </div>
                <button class="lb-copy" id="lbCopyBtn" onclick="copyFromLightbox()" title="Kısayol: C">Linki Kopyala</button>
            </div>

            <div class="lb-right-group">
                <button class="lb-mini-nav" id="lbBotPrev" onclick="changeSlide(-1)">&#10094;</button>
                <button class="lb-mini-nav" id="lbBotNext" onclick="changeSlide(1)">&#10095;</button>
            </div>
        </div>
    </div>
</div>

<div id="detailsModal" class="modal">
    <div class="details-modal-content">
        <div class="details-header">
            <h3 data-lang="modalTitle" style="margin:0;">Oluşturulan Linkler</h3>
            <span class="close-details" onclick="closeDetails()">&times;</span>
        </div>
        <div class="details-body">
            <table class="link-table">
                <thead>
                    <tr>
                        <th data-lang="thImage" style="width: 70px;">Resim</th>
                        <th data-lang="thDirect">Direkt Link</th>
                        <th data-lang="thAction" style="width: 80px;">İşlem</th>
                    </tr>
                </thead>
                <tbody id="detailsTableBody"></tbody>
            </table>
        </div>
        <div class="details-footer">
            <button class="btn-footer btn-excel" onclick="exportToExcel()">
                <svg style="width:16px;height:16px;fill:white" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                <span data-lang="btnExcel">Excel İndir</span>
            </button>
            <button class="btn-footer btn-copy-all" onclick="copyAllLinks()">
                <svg style="width:16px;height:16px;fill:white" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                <span data-lang="btnCopyAll">Tümünü Kopyala</span>
            </button>
        </div>
    </div>
</div>

<div id="confirmModal" class="modal">
    <div class="confirm-box">
        <h3 id="confirmTitle" style="margin-top:0;">Onay</h3>
        <p id="confirmMsg">Bu işlem geri alınamaz.</p>
        <img id="confirmImg" class="confirm-thumb" style="display:none;">
        <div class="confirm-btns">
            <button class="btn-yes" id="btnConfirmYes">Evet, Sil</button>
            <button class="btn-no" onclick="closeConfirm()">İptal</button>
        </div>
    </div>
</div>

<div class="container">
    <div class="lang-wrapper">
        <button class="lang-btn" onclick="toggleLangMenu(event)">
            <svg class="lang-icon" viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM2.04 4.326c.325 1.329 2.532 2.54 6.354 2.919V5.256c-4.42-1.379-6.354-2.919-6.354-2.919zm.344 7.625c.325-1.329 2.532-2.54 6.354-2.919v5.733c-3.822-.38-6.029-1.59-6.354-2.919zm11.576-7.625c-.325 1.329-2.532 2.54-6.354 2.919V5.256c4.42-1.379 6.354-2.919 6.354-2.919zm-.344 7.625c-.325-1.329-2.532-2.54-6.354-2.919v5.733c3.822-.38 6.029-1.59 6.354-2.919z"/><path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"/></svg>
            <span id="currentLangLabel">TR</span>
        </button>
        <ul class="lang-list" id="langList">
            <li onclick="selectLang('tr')">Türkçe</li>
            <li onclick="selectLang('en')">English</li>
            <li onclick="selectLang('zh')">中文 (Chinese)</li>
            <li onclick="selectLang('es')">Español</li>
            <li onclick="selectLang('hi')">हिन्दी (Hindi)</li>
            <li onclick="selectLang('ar')">العربية (Arabic)</li>
            <li onclick="selectLang('pt')">Português</li>
            <li onclick="selectLang('ru')">Русский</li>
            <li onclick="selectLang('ja')">日本語 (Japanese)</li>
            <li onclick="selectLang('de')">Deutsch</li>
            <li onclick="selectLang('fr')">Français</li>
        </ul>
    </div>

    <h3 style="margin-top:0; padding-right: 80px;" data-lang="title">Google Drive Resim Linki Dönüştürücü</h3>
    
    <label class="label" data-lang="labelInput">Normal Drive Linki:</label>
    <div class="input-group">
        <input type="text" id="driveLink" placeholder="Linkleri buraya yapıştırın (Virgülle ayırabilirsiniz)..." onclick="this.select()" oninput="dinamikKontrol()">
        <button class="paste-btn" id="btnPaste" onclick="yapistir()" title="Panodan Yapıştır">
            <svg viewBox="0 0 24 24"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 16H5V5h2v1c0 .55.45 1 1 1h8c.55 0 1-.45 1-1V5h2v14z"/></svg>
        </button>
    </div>
    
    <button id="btnConvert" class="convert-btn" onclick="linkDonustur()" data-lang="btnConvert">Dönüştür</button>

    <div id="galleryArea">
        <label class="label" data-lang="labelGallery">Oluşturulan Resimler:</label>
        <div class="gallery-grid" id="galleryGrid"></div>
        <div class="batch-controls" id="batchControls">
            <button class="btn-delete-selected" id="btnDelSel" onclick="confirmDeleteSelected()" data-lang="btnDeleteSelected">Seçilenleri Sil</button>
            
            <div style="display:flex; gap:10px; margin-left:auto;">
                <button class="btn-primary-soft" onclick="showDetails()" data-lang="btnDetails">Detaylı Liste</button>
                <button class="btn-outline-danger" onclick="confirmClearGallery()" data-lang="btnClear">Tümünü Temizle</button>
            </div>
        </div>
    </div>
</div>

<script>
    let history = []; 
    let currentLang = 'tr';
    let dinamikModAktif = false; 
    let activeLightboxIndex = 0; 
    let lastAddedIds = []; // Son eklenenler (Yeşil)
    let selectedIndices = []; // Ctrl ile seçilenler (Turuncu)
    let currentZoom = 1; 
    const driveRegex = /drive\.google\.com\/.*?\/d\/([a-zA-Z0-9_-]{25,})/;

    const translations = {
        tr: { title: "Google Drive Resim Linki Dönüştürücü", labelInput: "Normal Drive Linki:", placeholder: "Linkleri buraya yapıştırın (Virgülle ayırabilirsiniz)...", btnConvert: "Dönüştür", labelGallery: "Oluşturulan Resimler:", btnDetails: "Detaylı Liste", btnClear: "Tümünü Temizle", btnDeleteSelected: "Seçilenleri Sil", errEmpty: "Link Girilmedi!", errInvalid: "Geçersiz Link!", msgCopied: "Kopyalandı!", btnCopy: "Kopyala", modalTitle: "Oluşturulan Linkler", thImage: "Resim", thDirect: "Direkt Link", thAction: "İşlem", btnDelete: "Sil", btnCopyAll: "Tümünü Kopyala", btnExcel: "Excel İndir", confirmTitle: "Silme Onayı", confirmDelAll: "Tüm galeri silinecek. Emin misiniz?", confirmDelOne: "Bu resmi silmek istediğinize emin misiniz?", confirmDelSel: "Seçilen resimleri silmek istediğinize emin misiniz?", btnYes: "Evet, Sil", btnNo: "İptal", pasteTooltip: "Panodan Yapıştır" },
        en: { title: "Google Drive Direct Link Generator", labelInput: "Original Drive Link:", placeholder: "Paste links here (comma separated)...", btnConvert: "Convert", labelGallery: "Generated Images:", btnDetails: "Detailed List", btnClear: "Clear All", btnDeleteSelected: "Delete Selected", errEmpty: "No Link Entered!", errInvalid: "Invalid Link!", msgCopied: "Copied!", btnCopy: "Copy", modalTitle: "Generated Links", thImage: "Image", thDirect: "Direct Link", thAction: "Action", btnDelete: "Delete", btnCopyAll: "Copy All", btnExcel: "Download Excel", confirmTitle: "Delete Confirmation", confirmDelAll: "All gallery will be deleted. Are you sure?", confirmDelOne: "Are you sure you want to delete this image?", confirmDelSel: "Are you sure you want to delete selected images?", btnYes: "Yes, Delete", btnNo: "Cancel", pasteTooltip: "Paste from Clipboard" },
        zh: { title: "Google Drive 直接链接生成器", labelInput: "原始 Drive 链接：", placeholder: "在此处粘贴链接（以逗号分隔）...", btnConvert: "转换", labelGallery: "生成的图片：", btnDetails: "详细列表", btnClear: "全部清除", btnDeleteSelected: "删除所选", errEmpty: "未输入链接！", errInvalid: "无效链接！", msgCopied: "已复制！", btnCopy: "复制", modalTitle: "生成的链接", thImage: "图片", thDirect: "直接链接", thAction: "操作", btnDelete: "删除", btnCopyAll: "复制全部", btnExcel: "下载 Excel", confirmTitle: "删除确认", confirmDelAll: "所有图库都将被删除。你确定吗？", confirmDelOne: "您确定要删除此图片吗？", confirmDelSel: "您确定要删除所选图片吗？", btnYes: "是，删除", btnNo: "取消", pasteTooltip: "从剪贴板粘贴" },
        de: { title: "Google Drive Direktlink-Generator", labelInput: "Original-Link:", placeholder: "Links hier einfügen...", btnConvert: "Umwandeln", labelGallery: "Generierte Bilder:", btnDetails: "Detaillierte Liste", btnClear: "Alles löschen", btnDeleteSelected: "Ausgewählte löschen", errEmpty: "Kein Link eingegeben!", errInvalid: "Ungültiger Link!", msgCopied: "Kopiert!", btnCopy: "Kopieren", modalTitle: "Generierte Links", thImage: "Bild", thDirect: "Direktlink", thAction: "Aktion", btnDelete: "Löschen", btnCopyAll: "Alles Kopieren", btnExcel: "Excel Herunterladen", confirmTitle: "Löschbestätigung", confirmDelAll: "Die gesamte Galerie wird gelöscht. Sind Sie sicher?", confirmDelOne: "Möchten Sie dieses Bild wirklich löschen?", confirmDelSel: "Möchten Sie die ausgewählten Bilder löschen?", btnYes: "Ja, Löschen", btnNo: "Abbrechen", pasteTooltip: "Aus Zwischenablage einfügen" },
        fr: { title: "Générateur de liens directs Drive", labelInput: "Lien Original:", placeholder: "Collez les liens ici...", btnConvert: "Convertir", labelGallery: "Images générées :", btnDetails: "Liste détaillée", btnClear: "Tout effacer", btnDeleteSelected: "Supprimer la sélection", errEmpty: "Aucun lien saisi !", errInvalid: "Lien invalide !", msgCopied: "Copié !", btnCopy: "Copier", modalTitle: "Liens générés", thImage: "Image", thDirect: "Lien direct", thAction: "Action", btnDelete: "Supprimer", btnCopyAll: "Tout Copier", btnExcel: "Télécharger Excel", confirmTitle: "Confirmation de suppression", confirmDelAll: "Toute la galerie sera supprimée. Êtes-vous sûr ?", confirmDelOne: "Êtes-vous sûr de vouloir supprimer cette image ?", confirmDelSel: "Êtes-vous sûr de vouloir supprimer les images sélectionnées ?", btnYes: "Oui, Supprimer", btnNo: "Annuler", pasteTooltip: "Coller depuis le presse-papiers" },
        es: { title: "Generador de Enlaces Directos Drive", labelInput: "Enlace Original:", placeholder: "Pega los enlaces aquí...", btnConvert: "Convertir", labelGallery: "Imágenes Generadas:", btnDetails: "Lista Detallada", btnClear: "Borrar Todo", btnDeleteSelected: "Eliminar Seleccionados", errEmpty: "¡Enlace no introducido!", errInvalid: "¡Enlace Inválido!", msgCopied: "¡Copiado!", btnCopy: "Copiar", modalTitle: "Enlaces Generados", thImage: "Imagen", thDirect: "Enlace Directo", thAction: "Acción", btnDelete: "Eliminar", btnCopyAll: "Copiar Todo", btnExcel: "Descargar Excel", confirmTitle: "Confirmación de eliminación", confirmDelAll: "¿Se eliminará toda la galería. Estás seguro?", confirmDelOne: "¿Estás seguro de que quieres eliminar esta imagen?", confirmDelSel: "¿Estás seguro de que quieres eliminar las imágenes seleccionadas?", btnYes: "Sí, Eliminar", btnNo: "Cancelar", pasteTooltip: "Pegar desde portapapeles" },
        ru: { title: "Генератор прямых ссылок Drive", labelInput: "Исходная ссылка:", placeholder: "Вставьте ссылки сюда...", btnConvert: "Конвертировать", labelGallery: "Созданные изображения:", btnDetails: "Подробный список", btnClear: "Очистить все", btnDeleteSelected: "Удалить выбранные", errEmpty: "Ссылка не введена!", errInvalid: "Неверная ссылка!", msgCopied: "Скопировано!", btnCopy: "Копировать", modalTitle: "Созданные ссылки", thImage: "Изображение", thDirect: "Прямая ссылка", thAction: "Действие", btnDelete: "Удалить", btnCopyAll: "Копировать все", btnExcel: "Скачать Excel", confirmTitle: "Подтверждение удаления", confirmDelAll: "Вся галерея будет удалена. Вы уверены?", confirmDelOne: "Вы уверены, что хотите удалить это изображение?", confirmDelSel: "Вы уверены, что хотите удалить выбранные изображения?", btnYes: "Да, удалить", btnNo: "Отмена", pasteTooltip: "Вставить из буфера" },
        ar: { title: "محول روابط جوجل درايف", labelInput: "رابط درايف الأصلي:", placeholder: "الصق الروابط هنا...", btnConvert: "تحويل", labelGallery: "الصور التي تم إنشاؤها:", btnDetails: "قائمة مفصلة", btnClear: "مسح الكل", btnDeleteSelected: "حذف المختار", errEmpty: "لم يتم إدخال رابط!", errInvalid: "رابط غير صالح!", msgCopied: "تم النسخ!", btnCopy: "نسخ", modalTitle: "الروابط التي تم إنشاؤها", thImage: "صورة", thDirect: "رابط مباشر", thAction: "عمل", btnDelete: "حذف", btnCopyAll: "نسخ الكل", btnExcel: "تحميل إكسل", confirmTitle: "تأكيد الحذف", confirmDelAll: "سيتم حذف كل المعرض. هل أنت متأكد؟", confirmDelOne: "هل أنت متأكد أنك تريد حذف هذه الصورة؟", confirmDelSel: "هل أنت متأكد أنك تريد حذف الصور المحددة؟", btnYes: "نعم، حذف", btnNo: "إلغاء", pasteTooltip: "لصق من الحافظة" },
        hi: { title: "Google Drive डायरेक्ट लिंक जेनरेटर", labelInput: "मूल ड्राइव लिंक:", placeholder: "लिंक यहाँ पेस्ट करें...", btnConvert: "बदलें", labelGallery: "उत्पन्न चित्र:", btnDetails: "विस्तृत सूची", btnClear: "सभी साफ करें", btnDeleteSelected: "चयनित हटाएं", errEmpty: "लिंक दर्ज नहीं किया गया!", errInvalid: "अमान्य लिंक!", msgCopied: "कॉपी हो गया!", btnCopy: "कॉपी", modalTitle: "उत्पन्न लिंक", thImage: "छवि", thDirect: "डायरेक्ट लिंक", thAction: "कार्रवाई", btnDelete: "हटाएं", btnCopyAll: "सभी कॉपी करें", btnExcel: "एक्सेल डाउनलोड करें", confirmTitle: "हटाने की पुष्टि", confirmDelAll: "पूरी गैलरी हटा दी जाएगी। क्या आपको यकीन है?", confirmDelOne: "क्या आप वाकई इस छवि को हटाना चाहते हैं?", confirmDelSel: "क्या आप वाकई चयनित छवियों को हटाना चाहते हैं?", btnYes: "हाँ, हटाएं", btnNo: "रद्द करें", pasteTooltip: "क्लिपबोर्ड से चिपकाएं" },
        pt: { title: "Gerador de Links Diretos Drive", labelInput: "Link Original:", placeholder: "Cole os links aqui...", btnConvert: "Converter", labelGallery: "Imagens Geradas:", btnDetails: "Lista Detalhada", btnClear: "Limpar Tudo", btnDeleteSelected: "Excluir Selecionados", errEmpty: "Nenhum link inserido!", errInvalid: "Link Inválido!", msgCopied: "Copiado!", btnCopy: "Copiar", modalTitle: "Links Gerados", thImage: "Imagem", thDirect: "Link Direto", thAction: "Ação", btnDelete: "Excluir", btnCopyAll: "Copiar Tudo", btnExcel: "Baixar Excel", confirmTitle: "Confirmação de Exclusão", confirmDelAll: "Toda a galeria será excluída. Tem certeza?", confirmDelOne: "Tem certeza de que deseja excluir esta imagem?", confirmDelSel: "Tem certeza de que deseja excluir as imagens selecionadas?", btnYes: "Sim, Excluir", btnNo: "Cancelar", pasteTooltip: "Colar da área de transferência" },
        ja: { title: "Google Drive 直リンク作成ツール", labelInput: "元のリンク:", placeholder: "ここにリンクを貼り付け...", btnConvert: "変換", labelGallery: "生成された画像:", btnDetails: "詳細リスト", btnClear: "すべてクリア", btnDeleteSelected: "選択項目を削除", errEmpty: "リンク未入力！", errInvalid: "無効なリンクです!", msgCopied: "コピーしました!", btnCopy: "コピー", modalTitle: "生成されたリンク", thImage: "画像", thDirect: "直リンク", thAction: "操作", btnDelete: "削除", btnCopyAll: "すべてコピー", btnExcel: "Excelをダウンロード", confirmTitle: "削除の確認", confirmDelAll: "すべてのギャラリーが削除されます。よろしいですか？", confirmDelOne: "この画像を削除してもよろしいですか？", confirmDelSel: "選択した画像を削除してもよろしいですか？", btnYes: "はい、削除", btnNo: "キャンセル", pasteTooltip: "クリップボードから貼り付け" }
    };

    // --- GLOBAL TIKLAMA (CLICK OUTSIDE) ---
    function handleGlobalClick(e) {
        // Modal Backdrop Kontrolü
        if(e.target.classList.contains('modal')) {
            if(e.target.id === 'lightboxModal') closeLightbox();
            if(e.target.id === 'detailsModal') closeDetails();
            if(e.target.id === 'confirmModal') closeConfirm();
        }
        
        // Dil Menüsü Dışına Tıklama
        let l = document.getElementById("langList");
        let b = document.querySelector(".lang-btn");
        if(l.style.display === "block" && !l.contains(e.target) && !b.contains(e.target)) {
            l.style.display = "none";
        }

        // Galeri Çoklu Seçim İptali (Boşluğa tıklanırsa)
        if(selectedIndices.length > 0) {
            // Eğer tıklanan yer galeri item'ı, silme butonu veya overlay butonu değilse
            if(!e.target.closest('.gallery-item') && !e.target.closest('#btnDelSel')) {
                selectedIndices = [];
                renderGallery(); // Seçimleri temizle
            }
        }
    }

    function toggleLangMenu(e) { e.stopPropagation(); var l = document.getElementById("langList"); l.style.display = (l.style.display === "block") ? "none" : "block"; }
    function selectLang(c) { currentLang = c; document.getElementById("langList").style.display = "none"; applyTranslations(); }

    function applyTranslations() {
        const t = translations[currentLang];
        document.querySelectorAll('[data-lang]').forEach(el => { if (t[el.getAttribute('data-lang')]) el.innerText = t[el.getAttribute('data-lang')]; });
        document.getElementById('driveLink').placeholder = t.placeholder;
        let lbCopy = document.getElementById('lbCopyBtn'); if(!lbCopy.innerText.includes("!")) lbCopy.innerText = t.btnCopy;
        var btnConvert = document.getElementById('btnConvert'); if (!btnConvert.classList.contains('error-shake')) btnConvert.innerText = t.btnConvert;
        if(document.getElementById("detailsModal").style.display === "block") showDetails(); 
    }

    function linkDonustur() {
        var btn = document.getElementById("btnConvert");
        if(btn.classList.contains('passive')) return;
        var inputElement = document.getElementById("driveLink");
        var rawInput = inputElement.value.trim();
        const t = translations[currentLang];

        if(rawInput === "") { hataAnimasyonu(t.errEmpty); return; }

        let links = rawInput.split(',').map(s => s.trim()).filter(s => s !== "");
        let hasValidLink = false;
        lastAddedIds = []; // Sadece bu işlemde eklenenler

        links.forEach(val => {
            if (val.match(/\/d\/(.+?)\//) && !val.startsWith("http")) val = "https://" + val;
            let idMatch = val.match(driveRegex);
            if (idMatch) {
                hasValidLink = true;
                let fileID = idMatch[1];
                let newLink = "https://drive.google.com/thumbnail?id=" + fileID + "&sz=w10000";
                
                history = history.filter(item => item.id !== fileID);
                history.unshift({ id: fileID, directLink: newLink, originalLink: val });
                lastAddedIds.push(fileID);
            }
        });

        if (!hasValidLink) { hataAnimasyonu(t.errInvalid); return; }
        
        renderGallery();
        dinamikModAktif = false; btn.classList.add("success-lock");
    }

    function renderGallery() {
        const grid = document.getElementById("galleryGrid");
        const area = document.getElementById("galleryArea");
        const batchCtrl = document.getElementById("batchControls");
        const btnDelSel = document.getElementById("btnDelSel");
        
        grid.innerHTML = ""; 
        if(history.length > 0) {
            area.style.display = "block";
            batchCtrl.style.display = (history.length > 1) ? "flex" : "none";
        } else {
            area.style.display = "none"; return;
        }

        // Seçim Butonu Kontrolü
        if(selectedIndices.length > 0) {
            btnDelSel.style.display = "block";
            btnDelSel.innerText = translations[currentLang].btnDeleteSelected + " (" + selectedIndices.length + ")";
        } else {
            btnDelSel.style.display = "none";
        }

        history.forEach((item, index) => {
            let div = document.createElement("div"); div.className = "gallery-item";
            
            // Yeni eklenenler (Yeşil)
            if(lastAddedIds.includes(item.id)) div.classList.add("active-item");
            
            // Seçilenler (Turuncu)
            if(selectedIndices.includes(index)) div.classList.add("selected-item");

            let img = document.createElement("img"); img.src = item.directLink;
            
            // Tıklama Yönetimi
            div.onclick = (e) => {
                if(e.ctrlKey || e.metaKey) {
                    toggleSelection(index);
                } else {
                    openLightbox(index);
                }
            };

            let btn = document.createElement("div"); btn.className = "overlay-copy-btn";
            btn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>';
            btn.onclick = (e) => { e.stopPropagation(); copyDirect(item.directLink, btn, img); };
            div.appendChild(img); div.appendChild(btn); grid.appendChild(div);
        });
    }

    function toggleSelection(index) {
        if(selectedIndices.includes(index)) {
            selectedIndices = selectedIndices.filter(i => i !== index);
        } else {
            selectedIndices.push(index);
        }
        renderGallery();
    }

    // --- CUSTOM CONFIRM ---
    let confirmCallback = null;
    function showConfirm(msg, imgSrc, callback) {
        const t = translations[currentLang];
        document.getElementById("confirmTitle").innerText = t.confirmTitle;
        document.getElementById("confirmMsg").innerText = msg;
        document.getElementById("btnConfirmYes").innerText = t.btnYes;
        document.querySelector(".btn-no").innerText = t.btnNo;
        
        let imgEl = document.getElementById("confirmImg");
        if(imgSrc) { imgEl.src = imgSrc; imgEl.style.display = "block"; } 
        else { imgEl.style.display = "none"; }
        
        confirmCallback = callback;
        document.getElementById("confirmModal").style.display = "block";
    }
    document.getElementById("btnConfirmYes").onclick = function() { if(confirmCallback) confirmCallback(); closeConfirm(); };
    function closeConfirm() { document.getElementById("confirmModal").style.display = "none"; confirmCallback = null; }

    function confirmClearGallery() {
        const t = translations[currentLang];
        showConfirm(t.confirmDelAll, null, function() {
            history = []; lastAddedIds = []; selectedIndices = [];
            renderGallery();
            document.getElementById("driveLink").value = "";
            document.getElementById("btnConvert").classList.remove("success-lock");
        });
    }

    function confirmDeleteSelected() {
        const t = translations[currentLang];
        showConfirm(t.confirmDelSel, null, function() {
            // İndexler kayacağı için ters sırala ve sil
            selectedIndices.sort((a, b) => b - a);
            selectedIndices.forEach(idx => history.splice(idx, 1));
            selectedIndices = [];
            renderGallery();
        });
    }

    function deleteFromLightbox() {
        const t = translations[currentLang];
        showConfirm(t.confirmDelOne, history[activeLightboxIndex].directLink, function() {
            let deletedId = history[activeLightboxIndex].id;
            history.splice(activeLightboxIndex, 1);
            lastAddedIds = lastAddedIds.filter(id => id !== deletedId);
            if(activeLightboxIndex >= history.length) activeLightboxIndex = history.length - 1;
            renderGallery();
            if(history.length === 0) closeLightbox(); else updateLightboxContent();
        });
    }

    // --- LIGHTBOX ---
    function openLightbox(index) {
        activeLightboxIndex = index;
        updateLightboxContent();
        document.getElementById("lightboxModal").style.display = "block";
        
        // Mouse Wheel Listener Ekle
        document.getElementById("lightboxModal").addEventListener("wheel", handleWheel, { passive: false });
        document.addEventListener('keydown', lightboxKeyHandler);
    }
    function closeLightbox() {
        document.getElementById("lightboxModal").style.display = "none";
        document.getElementById("lightboxModal").removeEventListener("wheel", handleWheel);
        document.removeEventListener('keydown', lightboxKeyHandler);
    }
    function updateLightboxContent() {
        if (history.length === 0) { closeLightbox(); return; }
        if (activeLightboxIndex >= history.length) activeLightboxIndex = 0;
        if (activeLightboxIndex < 0) activeLightboxIndex = history.length - 1;
        
        let item = history[activeLightboxIndex];
        let img = document.getElementById("lbImage");
        
        // RESET ZOOM (ANIMASYONSUZ)
        img.style.transition = 'none'; 
        currentZoom = 1;
        img.style.transform = `scale(${currentZoom})`;
        
        // Resmi değiştir
        img.src = item.directLink;
        
        // Transition'ı geri aç (Küçük gecikme ile)
        setTimeout(() => { img.style.transition = 'transform 0.2s ease'; }, 10);

        const t = translations[currentLang];
        let btn = document.getElementById("lbCopyBtn");
        btn.innerText = t.btnCopy; btn.style.backgroundColor = "#fd7e14";
    }

    function changeSlide(direction) {
        if(history.length === 0) return;
        activeLightboxIndex += direction;
        updateLightboxContent();
    }

    function zoomImage(amount) {
        currentZoom += amount;
        if (currentZoom < 0.5) currentZoom = 0.5;
        if (currentZoom > 5) currentZoom = 5;
        document.getElementById("lbImage").style.transform = `scale(${currentZoom})`;
    }

    function handleWheel(e) {
        e.preventDefault();
        if (e.deltaY < 0) zoomImage(0.2); // Yukarı kaydırınca büyüt
        else zoomImage(-0.2); // Aşağı kaydırınca küçült
    }

    function lightboxKeyHandler(e) {
        // Sadece YAN tuşlar animasyon yapsın
        if (e.key === "ArrowRight") { changeSlide(1); let b = document.getElementById("lbMidNext"); b.classList.add("key-active"); setTimeout(()=>b.classList.remove("key-active"),150); }
        if (e.key === "ArrowLeft") { changeSlide(-1); let b = document.getElementById("lbMidPrev"); b.classList.add("key-active"); setTimeout(()=>b.classList.remove("key-active"),150); }
        if (e.key === "Escape") closeLightbox();
        if (e.key.toLowerCase() === "c") copyFromLightbox();
        if (e.key === "Delete" || e.key === "Backspace") deleteFromLightbox();
        if (e.key === "+" || e.key === "Add") zoomImage(0.2);
        if (e.key === "-" || e.key === "Subtract") zoomImage(-0.2);
    }

    function copyFromLightbox() {
        let link = history[activeLightboxIndex].directLink;
        let btn = document.getElementById("lbCopyBtn");
        const t = translations[currentLang];
        navigator.clipboard.writeText(link).then(() => {
            btn.innerText = t.msgCopied; btn.style.backgroundColor = "#198754";
            setTimeout(() => { btn.innerText = t.btnCopy; btn.style.backgroundColor = "#fd7e14"; }, 1500);
        });
    }

    // --- DETAYLAR & EXCEL ---
    function showDetails() {
        const tbody = document.getElementById("detailsTableBody");
        const t = translations[currentLang];
        tbody.innerHTML = "";
        history.forEach((item, index) => {
            let row = document.createElement("tr");
            
            let cellImg = document.createElement("td");
            let img = document.createElement("img");
            img.src = item.directLink; img.className = "tbl-thumb";
            img.onclick = () => { openLightbox(index); };
            cellImg.appendChild(img);

            let cellLink = document.createElement("td");
            let divWrap = document.createElement("div"); divWrap.className = "link-text-wrapper";
            let spanLink = document.createElement("div"); spanLink.className = "link-text"; spanLink.innerText = item.directLink;
            let btnCopy = document.createElement("button"); btnCopy.className = "btn-copy-sm"; btnCopy.innerText = t.btnCopy;
            btnCopy.onclick = () => {
                navigator.clipboard.writeText(item.directLink).then(() => {
                    btnCopy.innerText = t.msgCopied; btnCopy.style.backgroundColor = "#198754";
                    setTimeout(() => { btnCopy.innerText = t.btnCopy; btnCopy.style.backgroundColor = "#6c757d"; }, 1000);
                });
            };
            divWrap.appendChild(spanLink); divWrap.appendChild(btnCopy);
            cellLink.appendChild(divWrap);

            let cellAct = document.createElement("td");
            let btnDel = document.createElement("button"); btnDel.className = "btn-danger-sm"; btnDel.innerText = t.btnDelete;
            btnDel.onclick = () => {
                showConfirm(t.confirmDelOne, item.directLink, function() {
                    let deletedId = history[index].id;
                    history.splice(index, 1);
                    lastAddedIds = lastAddedIds.filter(id => id !== deletedId);
                    renderGallery(); 
                    if(history.length === 0) closeDetails(); else showDetails();
                });
            };
            cellAct.appendChild(btnDel);
            row.appendChild(cellImg); row.appendChild(cellLink); row.appendChild(cellAct); tbody.appendChild(row);
        });
        document.getElementById("detailsModal").style.display = "block";
    }

    function copyAllLinks() {
        const t = translations[currentLang];
        let allLinks = history.map(item => item.directLink).join("\n");
        navigator.clipboard.writeText(allLinks).then(() => {
            let btn = document.querySelector(".btn-copy-all span");
            btn.innerText = t.msgCopied; setTimeout(() => { btn.innerText = t.btnCopyAll; }, 1500);
        });
    }

    function exportToExcel() {
        // Excel için HTML tablosu oluşturuyoruz
        // Resimler <img> etiketiyle eklenir, Excel web query modunda bunları gösterebilir
        let tableHTML = `
            <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
            <head><meta charset="UTF-8"></head>
            <body>
            <table border="1">
                <thead><tr><th style="width:120px;">Image</th><th>Direct Link</th><th>Original Link</th></tr></thead>
                <tbody>
        `;
        history.forEach(item => {
            tableHTML += `
                <tr height="100">
                    <td align="center" valign="middle"><img src="${item.directLink}" width="100" height="100"></td>
                    <td valign="middle"><a href="${item.directLink}">${item.directLink}</a></td>
                    <td valign="middle"><a href="${item.originalLink}">${item.originalLink}</a></td>
                </tr>
            `;
        });
        tableHTML += `</tbody></table></body></html>`;
        let blob = new Blob([tableHTML], { type: 'application/vnd.ms-excel' });
        let link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "drive_gallery_visual.xls";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function closeDetails() { document.getElementById("detailsModal").style.display = "none"; }
    function copyDirect(link, btnElement, imgElement) {
        navigator.clipboard.writeText(link).then(() => {
            let originalBg = btnElement.style.background;
            btnElement.style.background = "#198754"; btnElement.style.color = "white";
            imgElement.classList.add("flash-anim"); setTimeout(() => imgElement.classList.remove("flash-anim"), 400);
            setTimeout(() => { btnElement.style.background = ""; btnElement.style.color = ""; }, 500);
        });
    }

    function dinamikKontrol() {
        document.getElementById("btnConvert").classList.remove("success-lock");
        if (!dinamikModAktif) return;
        var val = document.getElementById("driveLink").value.trim();
        var btn = document.getElementById("btnConvert");
        const t = translations[currentLang];
        if (val === "") { btn.classList.add("passive"); btn.innerText = t.errEmpty; return; }
        if (!val.match(driveRegex)) { btn.classList.add("passive"); btn.innerText = t.errInvalid; } 
        else { btn.classList.remove("passive"); btn.innerText = t.btnConvert; }
    }

    function hataAnimasyonu(mesaj) {
        var btn = document.getElementById("btnConvert");
        btn.classList.remove("success-lock"); btn.classList.add("error-shake"); btn.innerText = mesaj; dinamikModAktif = true;
        setTimeout(() => { btn.classList.remove("error-shake"); btn.classList.add("passive"); }, 1000);
    }

    async function yapistir() {
        var inputAlani = document.getElementById("driveLink");
        var pasteBtn = document.getElementById("btnPaste");
        try {
            const text = await navigator.clipboard.readText();
            inputAlani.value = text; dinamikKontrol();
            pasteBtn.style.backgroundColor = "#198754"; setTimeout(() => pasteBtn.style.backgroundColor = "", 1500);
            if (text.match(driveRegex)) linkDonustur();
        } catch (err) { console.error("Hata:", err); inputAlani.value = ""; dinamikKontrol(); }
    }
</script>

</body>
</html>
