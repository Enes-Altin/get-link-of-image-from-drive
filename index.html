<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive Link Dönüştürücü</title>
    <style>
        /* TEMEL STİLLER */
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4; margin: 0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .label { font-weight: bold; margin-top: 10px; display: block; margin-bottom: 5px;}

        /* INPUT GROUP */
        .input-group { display: flex; align-items: center; margin: 10px 0; }

        /* Metin Kutusu */
        input[type="text"] { 
            flex: 1; padding: 10px; border: 1px solid #ddd; 
            border-top-left-radius: 4px; border-bottom-left-radius: 4px; 
            border-top-right-radius: 0; border-bottom-right-radius: 0; 
            border-right: none; height: 40px; box-sizing: border-box;
            transition: border-color 0.3s;
        }
        /* Kutuya tıklandığında (focus) oluşan mavi çerçeve kalsın ama kodla odaklanınca rahatsız etmesin */

        /* BUTON ANİMASYONLARI (Tıklama Hissi) */
        button:active { transform: scale(0.96); }

        /* Yapıştır Butonu */
        .paste-btn {
            background-color: #6c757d; color: white; border: 1px solid #6c757d;
            border-top-right-radius: 4px; border-bottom-right-radius: 4px;
            cursor: pointer; width: 50px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            transition: background-color 0.2s, transform 0.1s; padding: 0;
        }
        .paste-btn:hover { background-color: #5c636a; }
        .paste-btn svg { width: 20px; height: 20px; fill: white; }

        /* DÖNÜŞTÜR BUTONU */
        .convert-btn { 
            background-color: #0d6efd; color: white; padding: 10px 20px; 
            border: none; border-radius: 4px; cursor: pointer; width: 100%; 
            font-size: 14px; margin-bottom: 5px; 
            transition: background-color 0.2s, transform 0.1s;
        }
        .convert-btn:hover { background-color: #0b5ed7; }

        /* HATA ANİMASYONU */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        .error-shake {
            animation: shake 0.3s ease-in-out;
            background-color: #dc3545 !important; 
        }

        /* SONUÇ ALANI */
        .result-box { margin-top: 20px; padding: 10px; background-color: #e9ecef; border: 1px solid #ced4da; border-radius: 4px; word-break: break-all; display: none; }

        /* KOPYALA BUTONU */
        .copy-btn { 
            margin-top: 5px; background-color: #6c757d; color: white; border: none;
            padding: 5px 10px; border-radius: 4px; font-size: 12px; cursor: pointer;
            min-width: 120px; display: inline-block; text-align: center;
            transition: background-color 0.3s, transform 0.1s;
        }
        .copy-btn:hover { background-color: #5c636a; }
        .copy-btn:disabled { cursor: default; opacity: 1; transform: none; }

        #finalLink { 
            user-select: auto; cursor: default; 
            background: #fff; padding: 8px; border: 1px solid #ddd; 
            border-radius: 4px; font-size: 13px; color: #333; 
            transition: color 0.3s; /* Renk değişimi yumuşak olsun */
        }
    </style>
</head>
<body>

<div class="container">
    <h3 style="margin-top:0;">Google Drive Resim Linki Dönüştürücü</h3>
    
    <label class="label">Normal Drive Linki:</label>
    
    <div class="input-group">
        <input type="text" id="driveLink" placeholder="https://drive.google.com/file/d/...." onclick="this.select()">
        
        <button class="paste-btn" id="btnPaste" onclick="yapistir()" title="Panodan Yapıştır">
            <svg viewBox="0 0 24 24">
                <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 16H5V5h2v1c0 .55.45 1 1 1h8c.55 0 1-.45 1-1V5h2v14z"/>
            </svg>
        </button>
    </div>
    
    <button id="btnConvert" class="convert-btn" onclick="linkDonustur()">Dönüştür</button>

    <div class="result-box" id="resultArea">
        <label class="label">Direkt Resim Linkin:</label>
        <div id="finalLink"></div>
        <button id="btnCopy" class="copy-btn" onclick="kopyala()">Linki Kopyala</button>
        
        <br><br>
        <label class="label">Önizleme:</label>
        <img id="previewImg" src="" alt="Resim Önizleme" style="max-width: 100%; height: auto; border-radius: 4px; margin-top:5px;">
    </div>
</div>

<script>
    // Global değişken: Son işlenen linki hafızada tutar
    var sonIslenenLink = "";

    function linkDonustur() {
        var inputElement = document.getElementById("driveLink");
        var val = inputElement.value.trim(); // Boşlukları temizle
        var btn = document.getElementById("btnConvert");

        // 1. BOŞ KONTROLÜ
        if(val === "") { 
            hataAnimasyonu("Link Yazın!");
            return; 
        } 

        // 2. DEĞİŞİKLİK KONTROLÜ (Aynı linke tekrar basılmasın)
        if(val === sonIslenenLink) {
            return; // Hiçbir şey yapma
        }

        // 3. EKSİK HTTPS DÜZELTME (Manuel yazılanlar için de geçerli olsun)
        // Eğer ID formatı uyuyor ama başında http yoksa ekle
        if (val.match(/\/d\/(.+?)\//) && !val.startsWith("http")) {
            val = "https://" + val;
            inputElement.value = val; // Kutuyu da güncelle
        }

        // 4. FORMAT KONTROLÜ
        var idMatch = val.match(/\/d\/(.+?)\//);
        if (!idMatch) {
            hataAnimasyonu("Geçersiz Link!");
            return;
        }

        // --- İŞLEM BAŞARILI ---
        var fileID = idMatch[1];
        var newLink = "https://drive.google.com/thumbnail?id=" + fileID + "&sz=w10000";

        var finalDiv = document.getElementById("finalLink");
        finalDiv.innerText = newLink;
        finalDiv.style.color = "#333"; // Yeni link üretilince rengi siyaha/griye döndür

        document.getElementById("previewImg").src = newLink;
        document.getElementById("resultArea").style.display = "block";
        
        // Son işlenen linki güncelle
        sonIslenenLink = val;

        butonSifirla();
    }

    function hataAnimasyonu(mesaj) {
        var btn = document.getElementById("btnConvert");
        var orjinalMetin = "Dönüştür"; // Butonun orijinal metni sabit

        // Animasyon ve renk sınıfını ekle
        btn.classList.add("error-shake");
        btn.innerText = mesaj;

        // 1 Saniye sonra eski haline döndür
        setTimeout(function() {
            btn.classList.remove("error-shake");
            btn.innerText = orjinalMetin;
        }, 1000);
    }

    function kopyala() {
        var finalDiv = document.getElementById("finalLink");
        var btn = document.getElementById("btnCopy");

        navigator.clipboard.writeText(finalDiv.innerText).then(function() {
            // Buton İşlemleri
            btn.innerText = "Kopyalandı!";
            btn.style.backgroundColor = "#198754"; 
            btn.disabled = true; 
            
            // LİNK METNİ RENK DEĞİŞİMİ (Kalıcı Yeşil)
            finalDiv.style.color = "#198754"; 

            setTimeout(function(){ butonSifirla(); }, 1000);
        }, function(err) {
            alert("Kopyalanamadı: " + err);
        });
    }

    function butonSifirla() {
        var btn = document.getElementById("btnCopy");
        btn.innerText = "Linki Kopyala";
        btn.style.backgroundColor = "#6c757d"; 
        btn.disabled = false; 
        // Not: Link metninin rengini (#finalLink) burada sıfırlamıyoruz, 
        // kullanıcı yeni link dönüştürene kadar yeşil kalsın istendi.
    }

    async function yapistir() {
        var inputAlani = document.getElementById("driveLink");
        var pasteBtn = document.getElementById("btnPaste");

        // DİKKAT: inputAlani.focus() komutunu buradan kaldırdık.
        // Böylece yapıştır'a basınca kutunun çerçevesi yanmayacak.

        try {
            const text = await navigator.clipboard.readText();
            var processedText = text.trim();

            // Eksik HTTPS tamamlama
            if (processedText.match(/\/d\/(.+?)\//) && !processedText.startsWith("http")) {
                processedText = "https://" + processedText;
            }

            inputAlani.value = processedText;
            
            // Yeşil yanma süresi 1.5 saniye (1500ms) yapıldı
            pasteBtn.style.backgroundColor = "#198754"; 
            setTimeout(function() { pasteBtn.style.backgroundColor = ""; }, 1500);

            // Format doğruysa otomatik dönüştür
            // (Burada sonIslenenLink kontrolüne takılmasın diye manuel çağrı yapıyoruz,
            // ama linkDonustur içindeki kontrolü aşmak için sonIslenenLink'i sıfırlamıyoruz,
            // çünkü yeni bir link yapıştırıldıysa zaten farklıdır.)
            if (processedText.match(/\/d\/(.+?)\//)) {
                linkDonustur();
            }

        } catch (err) {
            console.error("Hata:", err);
            // Hata durumunda (izin yoksa) kutuyu temizle, kullanıcı elle girsin
            inputAlani.value = "";
        }
    }
</script>

</body>
</html>
